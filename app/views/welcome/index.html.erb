<div id="search">
  <% form_tag search_url, :name => "sitesearch", :method => 'get' do %>
    <div class="input">
      <%= text_field_tag :q, params[:q], :autocomplete => "off", :size => "25" %>
    </div>
    <div class="submit">
      <%= submit_tag t('search.search'), :name => nil %>
    </div>
    <div class="type clear">
      <%= radio_button_tag 'type', "products", true %><%= label_tag "type_products", t('activerecord.models.product') %>
      &nbsp;
      <%= radio_button_tag 'type', "stores" %><%= label_tag "type_stores", t('activerecord.models.user') %>
    </div>
  <% end %>
</div>

<% cols = 5 %>
<% rows = (@products.length / cols).to_i %>
<% start = 0 %>
<table class="product-listing">
  <% rows.times do %>
    <tbody>
      <tr>
	<% for product in @products[start...start=start+cols] %>
          <td>
	    <table class="product-item">
	      <tbody>
		<tr>
		  <td class="image">
		    <div class="image"><div class="image-shadow">
		      <% link_to product do %>
	                <%= image_tag(cloudfront(product.images.first.attachment.url(:small)), :width => "100px", :height => "100px") unless product.images.empty? %>
		      <% end %>
		    </div>
		    <div class="info clear">
		      <% link_to product do %>
                        <span class="name"><%= truncate(h(product.name), :length => 12) %></span>
		      <% end %>
		      <span class="price"><%= number_to_currency product.price %></span>
		      <span class="store"><%= link_to truncate(h(product.user.abbreviation), :length => 12), store_path(product.user.username) %></span>
		    </div>
		  </td>
		</tr>
	      </tbody>
	    </table>
	  </td>
        <% end %>
      </tr>
    </tbody>
  <% end %>
</table>
